<html>

<head>
  <meta charset="utf-8">
  <style>
    video {
      width: 320px;
    }
  </style>
</head>

<body>
  <div id="local">
    <h2>Local Video</h2>
  </div>
  <div id="remotes">
    <h2>Remote Videos</h2>
  </div>
  <script src="./sdp.js"></script>
  <script>
    async function getLocalRtpCaps() {
      const offerOptions = {
        offerToReceiveAudio: 1,
        offerToReceiveVideo: 1
      };
      let pc = new RTCPeerConnection();
      try {
        const offer = await pc.createOffer(offerOptions);
        const sections = SDPUtils.splitSections(offer.sdp);
        for (index in sections) {
          if (sections[index].indexOf('m=audio') == 0) {
            var audioRtpParameters = SDPUtils.parseRtpParameters(sections[index]);
          } else if (sections[index].indexOf('m=video') == 0) {
            var videoRtpParameters = SDPUtils.parseRtpParameters(sections[index]);
          }
        }
        const rtpParameters = SDPUtils.parseRtpParameters(sections[1]);
        let sdp = SDPUtils.writeSessionBoilerplate(0, undefined, 'qrtc') +
          SDPUtils.writeRtpDescription('audio', audioRtpParameters) +
          SDPUtils.writeRtpDescription('video', videoRtpParameters);
        return sdp;
      } catch (e) {
        console.log(`Get local RtpCaps faild: ${e}`);
      }
    }

    getLocalRtpCaps()
    .then(data => {
      console.log(`getLocalRtpCaps Return:\n%c${data}`, 'color:cyan');
    })
  </script>
</body>

</html>
